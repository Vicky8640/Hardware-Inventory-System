{% extends "base.html" %}
{% load static %}
{% load humanize %} 

{% block title %}Sales Dashboard{% endblock %}

{% block header_title %}Sales Dashboard{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
Â  Â  <h2 class="mb-4">ðŸ“Š Sales Performance Dashboard</h2>
Â  Â  
    {# --- EXPORT BUTTON (Already Correct) --- #}
Â  Â  <div class="d-flex justify-content-end mb-4">
Â  Â  <a href="{% url 'export_sales_data' %}" class="btn btn-success">
Â  Â  Â  Â  <i class="bi bi-download"></i> Export Data to CSV
Â  Â  </a>
    </div>

Â  Â  {# --- SECTION 1: TOTAL METRICS (FIXED CARD SIZE) --- #}
Â  Â  <div class="row g-3 mb-5">
        {# Using col-md-3 for three metrics + col-md-3 for spacing makes a 12-column grid #}
Â  Â  Â  Â  <div class="col-md-3"> 
Â  Â  Â  Â  Â  Â  <div class="card text-center bg-light shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title text-muted">Total Revenue</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-success">${{ total_metrics.total_revenue|default:0|intcomma }}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="col-md-3">
Â  Â  Â  Â  Â  Â  <div class="card text-center bg-light shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title text-muted">Net Profit</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-info">${{ total_metrics.net_profit|default:0|intcomma }}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="col-md-3">
Â  Â  Â  Â  Â  Â  <div class="card text-center bg-light shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title text-muted">Total Transactions</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-primary">{{ total_metrics.total_transactions|default:0|intcomma }}</h3> 
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
        {# Add a spacing column to keep the layout clean #}
        <div class="col-md-3"></div> 
Â  Â  </div>

Â  Â  <hr>

Â  Â  {# --- SECTION 2: SALES BY TYPE (Keys Corrected) --- #}
Â  Â  <h3 class="mb-3">Sales Breakdown by Type</h3>
Â  Â  <table class="table table-bordered table-hover shadow-sm">
Â  Â  Â  Â  <thead class="table-primary">
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Sale Type</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Transactions</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Assets Sold</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Revenue</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Profit</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  {% for sale_type_data in sales_by_type %}
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <td>**{{ sale_type_data.sale_type_label }}**</td> 
Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ sale_type_data.transaction_count }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ sale_type_data.assets_sold }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${{ sale_type_data.revenue|default:0|intcomma }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${{ sale_type_data.profit|default:0|intcomma }}</td>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  {% empty %}
Â  Â  Â  Â  Â  Â  <tr><td colspan="5" class="text-center">No sales data available.</td></tr>
Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  </tbody>
Â  Â  </table>

Â  Â  <hr>

Â  Â  {# --- SECTION 3: DATE TRACKING / TREND (Keys and Endfor Corrected) --- #}
Â  Â  <h3 class="mb-3">Sales Trend by Day</h3>
Â  Â  <div style="max-height: 400px; overflow-y: auto;">
Â  Â  Â  Â  <table class="table table-striped table-sm shadow-sm">
Â  Â  Â  Â  Â  Â  <thead class="table-dark sticky-top">
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Date</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Assets Sold</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Revenue</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Profit</th>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  {% for daily_data in sales_by_date %}
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ daily_data.date_group|date:"Y-m-d" }}</td> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ daily_data.daily_assets_sold }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${{ daily_data.daily_revenue|default:0|intcomma }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${{ daily_data.daily_profit|default:0|intcomma }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  {% empty %}
Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="4" class="text-center">No daily trend data available.</td></tr>
Â  Â  Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  </div>

</div>
{% endblock content %}